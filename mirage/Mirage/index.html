<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mirage (mirage.Mirage)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">mirage</a> &#x00BB; Mirage</nav><header class="odoc-preamble"><h1>Module <code><span>Mirage</span></code></h1><p><em>Release v4.0.0</em></p></header><nav class="odoc-toc"><ul><li><a href="#what-is-mirageos?">What is MirageOS?</a><ul><li><a href="#is-everything-really-written-in-ocaml?">Is everything really written in OCaml?</a></li><li><a href="#mirageos-as-a-cross-compilator">MirageOS as a cross-compilator</a><ul><li><a href="#mirageos-3.x">MirageOS 3.x</a><ul><li><a href="#mirageos-4.x">MirageOS 4.x</a></li></ul></li></ul></li></ul></li><li><a href="#mirageos-edsl">MirageOS eDSL</a><ul><li><a href="#combinators">Combinators</a></li><li><a href="#keys">Keys</a></li><li><a href="#pkg">Package dependencies</a></li><li><a href="#app">Application Builder</a></li><li><a href="#devices">Devices</a></li><li><a href="#jobs">Jobs</a></li><li><a href="#general-mirage-devices">General mirage devices</a></li><li><a href="#time">Time</a></li><li><a href="#clocks">Clocks</a></li><li><a href="#log-reporters">Log reporters</a></li><li><a href="#random">Random</a></li><li><a href="#consoles">Consoles</a></li><li><a href="#block-devices">Block devices</a></li><li><a href="#static-key/value-stores">Static key/value stores</a></li><li><a href="#filesystem">Filesystem</a></li><li><a href="#network-interfaces">Network interfaces</a></li><li><a href="#ethernet-configuration">Ethernet configuration</a></li><li><a href="#arp-configuration">ARP configuration</a></li><li><a href="#ip-configuration">IP configuration</a></li><li><a href="#udp-configuration">UDP configuration</a></li><li><a href="#tcp-configuration">TCP configuration</a></li><li><a href="#network-stack-configuration">Network stack configuration</a><ul><li><a href="#ipv6">IPv6</a></li><li><a href="#dual-ipv4-and-ipv6">Dual IPv4 and IPv6</a></li></ul></li><li><a href="#resolver-configuration">Resolver configuration</a></li><li><a href="#dns-client">DNS client</a></li><li><a href="#happy-eyeballs">Happy-eyeballs</a></li><li><a href="#syslog-configuration">Syslog configuration</a></li><li><a href="#entropy">Entropy</a></li><li><a href="#conduit-configuration">Conduit configuration</a></li><li><a href="#http-configuration">HTTP configuration</a></li><li><a href="#argv-configuration">Argv configuration</a></li><li><a href="#git-client-configuration">Git client configuration</a></li><li><a href="#other-devices">Other devices</a></li><li><a href="#application-registering">Application registering</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="what-is-mirageos?"><a href="#what-is-mirageos?" class="anchor"></a>What is MirageOS?</h2><p>MirageOS is a library operating system that can build standalone unikernels on various platforms. More precisely, the architecture can be divided into:</p><ul><li><em>operating system libraries</em> that implement kernel and protocol functionality, ranging from low-level network card drivers to a full reimplementation of the TLS protocol, through to a reimplementation of the Git protocol to store versioned data.</li></ul><ul><li>A set of <em>typed signatures</em> to make sure these libraries are consistent and can interoperate. As all the library are almost all pure OCaml code, we have defined <em>a set of OCaml module types</em> that encode these conventions in a statically enforcable way. We make no compatibility guarantees at the C level, but compile those on a best-effort basis.</li></ul><ul><li>Finally, MirageOS is also a <em>metaprogramming compiler</em> that generates OCaml code. It takes as input: the OCaml source code of a program and all of its dependencies, the full description of the deployment target, including configuration values (like the HTTP port to listen on, or the private key or the service being deployed). The `mirage`CLI tool uses all of these to <em>generate a executable unikernel</em>: a specialised binary artefact containing only the code what is needed to run on the given deployment platform and no more.</li></ul><p>It is possible to write high-level MirageOS applications, such as HTTPS, email or CalDAV servers which can be deployed on very heterogenous and embedded platforms by changing only a few compilation parameters. The supported platforms range from minimal virtual machines running on cloud providers, or processes running inside Docker containers configured with a tight security profile. In general, these platform do not have a full POSIX environment; MirageOS does not try to emulate POSIX and focuses on providing a small, well-defined, typed interface with the system components. The nearest equivalent to the MirageOS approach is the WASI (wasi.dev) set of interfaces for WebAssembly.</p><h3 id="is-everything-really-written-in-ocaml?"><a href="#is-everything-really-written-in-ocaml?" class="anchor"></a>Is everything really written in OCaml?</h3><p>While most of the code is written in OCaml, a typed, high-level language with many good safety properties, there are pieces of MirageOS which are still written in C. These bits can be separated in three categories:</p><ul><li>The OCaml runtime is written in C. It needs to be ported to the platform that MirageOS is trying to target, which do not support POSIX. Hence, the first component to port to a new platform is the OCaml runtime.</li></ul><ul><li>The low-level device drivers (network, console, clock, etc) also need some C bits.</li></ul><ul><li>The base usual C bindings; some libraries are widely used and (unfortunately) very hard (but not impossible) to replace them completely without taking a big performance hit or having to trust code without much real-world usages. This is the case for low-level bit handling for crypto code (even if we try to make sure allocation is alway handled by the OCaml runtime) as well as arbitrary precision numeric computation (e.g. gmp). Ideally we could image rewriting all of these libraries in OCaml if we had an infinite amount of time in our hands.</li></ul><h3 id="mirageos-as-a-cross-compilator"><a href="#mirageos-as-a-cross-compilator" class="anchor"></a>MirageOS as a cross-compilator</h3><p>The MirageOS compiler is basically a cross-compiler, where the host and target toolchain are identical, but with different flags for the C bindings: for instance, it is necessary to pass <code>-freestanding</code> to <em>all</em> C bindings to not use POSIX headers. The MirageOS compiler also uses a custom linker: eg. not only it needs a custom OCaml's runtime <code>libasmrun.a</code>, but it also needs to run a different linker to generate specialised executable images.</p><p>Historically, the OCaml ecosystem always had partial support for cross-compilation: for instance, the <a href="https://github.com/ocaml-cross/opam-cross-windows">ocaml-cross</a> way of doing it is to duplicate <em>all</em> existing opam pacakges by adding a <code>-windows</code> suffix to their names and dependencies; this allows normal packages and windows packages can be co-installed in the same opam switch.</p><h4 id="mirageos-3.x"><a href="#mirageos-3.x" class="anchor"></a>MirageOS 3.x</h4><p>MirageOS 3.x solves this by duplicating only the packages defining C bindings. It relies on every MirageOS backend registering a set of <code>CFLAGS</code> with <code>pkg-config</code>. Then every bindings uses <code>pkg-config</code> to configure their <code>CFLAGS</code> and <code>ocamlfind</code> to register <a href="https://github.com/ocaml/opam-repository/blob/master/packages/zarith-xen/zarith-xen.1.7/files/mirage-install.sh#L20">link-time predicates</a>, e.g. additional link time options like the name of the C archives. Finally, the final link step is done by querying ocamlfind (using the custom registered predicates) to link the list of dependencies' objects files with the result of OCam compiler's <code>--output-obj</code> option.</p><h5 id="mirageos-4.x"><a href="#mirageos-4.x" class="anchor"></a>MirageOS 4.x</h5><p>MirageOS 4 solves this by relying on <code>dune</code>'s built-in support for cross-compilation. This is done by gathering all the sources of the dependencies locally with <code>opam-monorepo</code>, and by creating a `dune-workspace` file describing the C flags to use in each cross-compilation &quot;context&quot;. Once this is set-up, only one <code>dune build</code> can cross-compile the unikernel target with all its local sources.</p><h2 id="mirageos-edsl"><a href="#mirageos-edsl" class="anchor"></a>MirageOS eDSL</h2><p>The rest of the document describes Functoria, the embedded domain-specific language to be used in <code>config.ml</code> files, to described how the typed libraries have to be assembled.</p><div class="odoc-include"><h3 id="combinators"><a href="#combinators" class="anchor"></a>Combinators</h3><div class="odoc-spec"><div class="spec type" id="type-typ" class="anchored"><a href="#type-typ" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a typ</span></span><span> = <span><span class="type-var">'a</span> <a href="../../functoria/Functoria/Type/index.html#type-t">Functoria.Type.t</a></span></span></code></div><div class="spec-doc"><p>The type for values representing module types.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-typ" class="anchored"><a href="#val-typ" class="anchor"></a><code><span><span class="keyword">val</span> typ : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p><code>type t</code> is a value representing the module type <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(@-&gt;)" class="anchored"><a href="#val-(@-&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (@-&gt;) : <span><span><span class="type-var">'a</span> <a href="#type-typ">typ</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-typ">typ</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span> )</span> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Construct a functor type from a type and an existing functor type. This corresponds to prepending a parameter to the list of functor parameters. For example:</p><pre><code>kv_ro @-&gt; ip @-&gt; kv_ro </code></pre><p>This describes a functor type that accepts two arguments -- a <code>kv_ro</code> and an <code>ip</code> device -- and returns a <code>kv_ro</code>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-impl" class="anchored"><a href="#type-impl" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a impl</span></span><span> = <span><span class="type-var">'a</span> <a href="../../functoria/Functoria/Impl/index.html#type-t">Functoria.Impl.t</a></span></span></code></div><div class="spec-doc"><p>The type for values representing module implementations.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-($)" class="anchored"><a href="#val-($)" class="anchor"></a><code><span><span class="keyword">val</span> ($) : <span><span><span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span> )</span> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>m $ a</code> applies the functor <code>m</code> to the module <code>a</code>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-abstract_impl" class="anchored"><a href="#type-abstract_impl" class="anchor"></a><code><span><span class="keyword">type</span> abstract_impl</span><span> = <a href="../../functoria/Functoria/Impl/index.html#type-abstract">Functoria.Impl.abstract</a></span></code></div><div class="spec-doc"><p>Same as <a href="#type-impl"><code>impl</code></a> but with hidden type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dep" class="anchored"><a href="#val-dep" class="anchor"></a><code><span><span class="keyword">val</span> dep : <span><span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-abstract_impl">abstract_impl</a></span></code></div><div class="spec-doc"><p><code>dep t</code> is the (build-time) dependency towards <code>t</code>.</p></div></div><h3 id="keys"><a href="#keys" class="anchor"></a>Keys</h3><div class="odoc-spec"><div class="spec type" id="type-key" class="anchored"><a href="#type-key" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a key</span></span><span> = <span><span class="type-var">'a</span> <a href="../../functoria/Functoria/Key/index.html#type-key">Functoria.Key.key</a></span></span></code></div><div class="spec-doc"><p>The type for command-line parameters.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-abstract_key" class="anchored"><a href="#type-abstract_key" class="anchor"></a><code><span><span class="keyword">type</span> abstract_key</span><span> = <a href="../../functoria/Functoria/Key/index.html#type-t">Functoria.Key.t</a></span></code></div><div class="spec-doc"><p>The type for abstract keys.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-context" class="anchored"><a href="#type-context" class="anchor"></a><code><span><span class="keyword">type</span> context</span><span> = <a href="../../functoria/Functoria/Key/index.html#type-context">Functoria.Key.context</a></span></code></div><div class="spec-doc"><p>The type for keys' parsing context. See <a href="Key/index.html#type-context"><code>Key.context</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-value" class="anchored"><a href="#type-value" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a value</span></span><span> = <span><span class="type-var">'a</span> <a href="../../functoria/Functoria/Key/index.html#type-value">Functoria.Key.value</a></span></span></code></div><div class="spec-doc"><p>The type for values parsed from the command-line. See <a href="Key/index.html#type-value"><code>Key.value</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-key" class="anchored"><a href="#val-key" class="anchor"></a><code><span><span class="keyword">val</span> key : <span><span><span class="type-var">'a</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="../../functoria/Functoria/Key/index.html#type-t">Functoria.Key.t</a></span></code></div><div class="spec-doc"><p><code>key k</code> is an untyped representation of <code>k</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-if_impl" class="anchored"><a href="#val-if_impl" class="anchor"></a><code><span><span class="keyword">val</span> if_impl : <span><span>bool <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>if_impl v impl1 impl2</code> is <code>impl1</code> if <code>v</code> is resolved to true and <code>impl2</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-match_impl" class="anchored"><a href="#val-match_impl" class="anchor"></a><code><span><span class="keyword">val</span> match_impl : <span><span><span class="type-var">'b</span> <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span> <span>default:<span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'b</span> * <span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>match_impl v cases ~default</code> chooses the implementation amongst <code>cases</code> by matching the <code>v</code>'s value. <code>default</code> is chosen if no value matches.</p></div></div><h3 id="pkg"><a href="#pkg" class="anchor"></a>Package dependencies</h3><p>For specifying opam package dependencies, the type <a href="#type-package"><code>package</code></a> is used. It consists of the opam package name, the ocamlfind names, and optional lower and upper bounds. The version constraints are merged with other modules.</p><div class="odoc-spec"><div class="spec type" id="type-package" class="anchored"><a href="#type-package" class="anchor"></a><code><span><span class="keyword">type</span> package</span><span> = <a href="../../functoria/Functoria/Package/index.html#type-t">Functoria.Package.t</a></span></code></div><div class="spec-doc"><p>The type for opam packages.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-scope" class="anchored"><a href="#type-scope" class="anchor"></a><code><span><span class="keyword">type</span> scope</span><span> = <a href="../../functoria/Functoria/Package/index.html#type-scope">Functoria.Package.scope</a></span></code></div><div class="spec-doc"><p>Installation scope of a package.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-package" class="anchored"><a href="#val-package" class="anchor"></a><code><span><span class="keyword">val</span> package : 
  <span>?scope:<a href="#type-scope">scope</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?build:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?sublibs:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?libs:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?min:string <span class="arrow">&#45;&gt;</span></span>
  <span>?max:string <span class="arrow">&#45;&gt;</span></span>
  <span>?pin:string <span class="arrow">&#45;&gt;</span></span>
  <span>?pin_version:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-package">package</a></span></code></div><div class="spec-doc"><p>Same as <a href="../../functoria/Functoria/Package/index.html#val-v"><code>Functoria.Package.v</code></a></p></div></div><h3 id="app"><a href="#app" class="anchor"></a>Application Builder</h3><p>Values of type <a href="#type-impl"><code>impl</code></a> are tied to concrete module implementation with the <a href="#type-device"><code>device</code></a> and <a href="#val-foreign"><code>foreign</code></a> construct. Module implementations of type <a href="#type-job"><code>job</code></a> can then be <a href="../../functoria/Functoria/Lib/Make/index.html#val-register">registered</a> into an application builder. The builder is in charge if parsing the command-line arguments and of generating code for the final application. See <a href="../../functoria/Functoria/Lib/index.html"><code>Functoria.Lib</code></a> for details.</p><div class="odoc-spec"><div class="spec type" id="type-info" class="anchored"><a href="#type-info" class="anchor"></a><code><span><span class="keyword">type</span> info</span><span> = <a href="../../functoria/Functoria/Info/index.html#type-t">Functoria.Info.t</a></span></code></div><div class="spec-doc"><p>The type for build information.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-foreign" class="anchored"><a href="#val-foreign" class="anchor"></a><code><span><span class="keyword">val</span> foreign : 
  <span>?packages:<span><a href="#type-package">package</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?packages_v:<span><span><a href="#type-package">package</a> list</span> <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?keys:<span><a href="#type-abstract_key">abstract_key</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?deps:<span><a href="#type-abstract_impl">abstract_impl</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-typ">typ</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Alias for <a href="#val-main"><code>main</code></a>, where <code>?extra_deps</code> has been renamed to <code>?deps</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-main" class="anchored"><a href="#val-main" class="anchor"></a><code><span><span class="keyword">val</span> main : 
  <span>?packages:<span><a href="#type-package">package</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?packages_v:<span><span><a href="#type-package">package</a> list</span> <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?keys:<span><a href="#type-abstract_key">abstract_key</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?extra_deps:<span><a href="#type-abstract_impl">abstract_impl</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-typ">typ</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>foreign name typ</code> is the functor <code>name</code>, having the module type <code>typ</code>. The connect code will call <code>&lt;name&gt;.start</code>.</p><ul><li>If <code>packages</code> or <code>packages_v</code> is set, then the given packages are installed before compiling the current application.</li><li>If <code>keys</code> is set, use the given <a href="Key/index.html#type-key">keys</a> to parse at configure and runtime the command-line arguments before calling <code>&lt;name&gt;.connect</code>.</li><li>If <code>extra_deps</code> is set, the given list of <a href="#type-abstract_impl">abstract</a> implementations is added as data-dependencies: they will be initialized before calling <code>&lt;name&gt;.connect</code>.</li></ul></div></div><h3 id="devices"><a href="#devices" class="anchor"></a>Devices</h3><div class="odoc-spec"><div class="spec type" id="type-device" class="anchored"><a href="#type-device" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a device</span></span><span> = <span><span>( <span class="type-var">'a</span>, <a href="#type-abstract_impl">abstract_impl</a> )</span> <a href="../../functoria/Functoria/Device/index.html#type-t">Functoria.Device.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-of_device" class="anchored"><a href="#val-of_device" class="anchor"></a><code><span><span class="keyword">val</span> of_device : <span><span><span class="type-var">'a</span> <a href="#type-device">device</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>of_device t</code> is the implementation device <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-impl" class="anchored"><a href="#val-impl" class="anchor"></a><code><span><span class="keyword">val</span> impl : 
  <span>?packages:<span><a href="#type-package">package</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?packages_v:<span><span><a href="#type-package">package</a> list</span> <a href="../../functoria/Functoria/Key/index.html#type-value">Functoria.Key.value</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?install:<span>( <span><a href="../../functoria/Functoria/Info/index.html#type-t">Functoria.Info.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../functoria/Functoria/Install/index.html#type-t">Functoria.Install.t</a> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?install_v:<span>( <span><a href="../../functoria/Functoria/Info/index.html#type-t">Functoria.Info.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../functoria/Functoria/Install/index.html#type-t">Functoria.Install.t</a> <a href="../../functoria/Functoria/Key/index.html#type-value">Functoria.Key.value</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?keys:<span><a href="../../functoria/Functoria/Key/index.html#type-t">Functoria.Key.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?extra_deps:<span><a href="#type-abstract_impl">abstract_impl</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?connect:<span>( <span><a href="#type-info">info</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> string )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?dune:<span>( <span><a href="#type-info">info</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../functoria/Functoria/Dune/index.html#type-stanza">Functoria.Dune.stanza</a> list</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?configure:<span>( <span><a href="#type-info">info</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../../functoria/Functoria/Action/index.html#type-t">Functoria.Action.t</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?files:<span>( <span><a href="#type-info">info</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Fpath</span>.t list</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-typ">typ</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>impl ...</code> is <code>of_device @@ Device.v ...</code></p></div></div><h3 id="jobs"><a href="#jobs" class="anchor"></a>Jobs</h3><div class="odoc-spec"><div class="spec type" id="type-job" class="anchored"><a href="#type-job" class="anchor"></a><code><span><span class="keyword">type</span> job</span></code></div></div></div><div class="odoc-spec"><div class="spec module" id="module-Key" class="anchored"><a href="#module-Key" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Key/index.html">Key</a></span><span> : <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../Mirage_key/index.html">Mirage_key</a> <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Configuration keys.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-abstract" class="anchored"><a href="#val-abstract" class="anchor"></a><code><span><span class="keyword">val</span> abstract : <span><span><span class="type-var">'a</span> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-abstract_impl">abstract_impl</a></span></code></div></div><h3 id="general-mirage-devices"><a href="#general-mirage-devices" class="anchor"></a>General mirage devices</h3><div class="odoc-spec"><div class="spec type" id="type-tracing" class="anchored"><a href="#type-tracing" class="anchor"></a><code><span><span class="keyword">type</span> tracing</span></code></div><div class="spec-doc"><p>The type for tracing.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tracing" class="anchored"><a href="#val-tracing" class="anchor"></a><code><span><span class="keyword">val</span> tracing : <span><a href="#type-tracing">tracing</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementation of the <a href="#type-tracing"><code>tracing</code></a> type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mprof_trace" class="anchored"><a href="#val-mprof_trace" class="anchor"></a><code><span><span class="keyword">val</span> mprof_trace : <span>size:int <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tracing">tracing</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Use mirage-profile to trace the unikernel. On Unix, this creates and mmaps a file called &quot;trace.ctf&quot;. On Xen, it shares the trace buffer with dom0.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">size:</span> <p>size of the ring buffer to use.</p></li></ul></div></div><div class="odoc-spec"><div class="spec type" id="type-qubesdb" class="anchored"><a href="#type-qubesdb" class="anchor"></a><code><span><span class="keyword">type</span> qubesdb</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-qubesdb" class="anchored"><a href="#val-qubesdb" class="anchor"></a><code><span><span class="keyword">val</span> qubesdb : <span><a href="#type-qubesdb">qubesdb</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>For the Qubes target, the Qubes database from which to look up * dynamic runtime configuration information.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_qubesdb" class="anchored"><a href="#val-default_qubesdb" class="anchor"></a><code><span><span class="keyword">val</span> default_qubesdb : <span><a href="#type-qubesdb">qubesdb</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>A default qubes database, guessed from the usual valid configurations.</p></div></div><h3 id="time"><a href="#time" class="anchor"></a>Time</h3><div class="odoc-spec"><div class="spec type" id="type-time" class="anchored"><a href="#type-time" class="anchor"></a><code><span><span class="keyword">type</span> time</span></code></div><div class="spec-doc"><p>Abstract type for timers.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-time" class="anchored"><a href="#val-time" class="anchor"></a><code><span><span class="keyword">val</span> time : <span><a href="#type-time">time</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementations of the <code>Mirage_types.TIME</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_time" class="anchored"><a href="#val-default_time" class="anchor"></a><code><span><span class="keyword">val</span> default_time : <span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>The default timer implementation.</p></div></div><h3 id="clocks"><a href="#clocks" class="anchor"></a>Clocks</h3><div class="odoc-spec"><div class="spec type" id="type-pclock" class="anchored"><a href="#type-pclock" class="anchor"></a><code><span><span class="keyword">type</span> pclock</span></code></div><div class="spec-doc"><p>Abstract type for POSIX clocks.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pclock" class="anchored"><a href="#val-pclock" class="anchor"></a><code><span><span class="keyword">val</span> pclock : <span><a href="#type-pclock">pclock</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementations of the <code>Mirage_clock.PCLOCK</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_posix_clock" class="anchored"><a href="#val-default_posix_clock" class="anchor"></a><code><span><span class="keyword">val</span> default_posix_clock : <span><a href="#type-pclock">pclock</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>The default mirage-clock PCLOCK implementation.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-mclock" class="anchored"><a href="#type-mclock" class="anchor"></a><code><span><span class="keyword">type</span> mclock</span></code></div><div class="spec-doc"><p>Abstract type for monotonic clocks</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mclock" class="anchored"><a href="#val-mclock" class="anchor"></a><code><span><span class="keyword">val</span> mclock : <span><a href="#type-mclock">mclock</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementations of the <code>Mirage_clock.MCLOCK</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_monotonic_clock" class="anchored"><a href="#val-default_monotonic_clock" class="anchor"></a><code><span><span class="keyword">val</span> default_monotonic_clock : <span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>The default mirage-clock MCLOCK implementation.</p></div></div><h3 id="log-reporters"><a href="#log-reporters" class="anchor"></a>Log reporters</h3><div class="odoc-spec"><div class="spec type" id="type-reporter" class="anchored"><a href="#type-reporter" class="anchor"></a><code><span><span class="keyword">type</span> reporter</span></code></div><div class="spec-doc"><p>The type for log reporters.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-reporter" class="anchored"><a href="#val-reporter" class="anchor"></a><code><span><span class="keyword">val</span> reporter : <span><a href="#type-reporter">reporter</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementation of the log <a href="#type-reporter"><code>reporter</code></a> type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_reporter" class="anchored"><a href="#val-default_reporter" class="anchor"></a><code><span><span class="keyword">val</span> default_reporter : 
  <span>?clock:<span><a href="#type-pclock">pclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?ring_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>?level:<span class="xref-unresolved">Logs</span>.level <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-reporter">reporter</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>default_reporter ?clock ?level ()</code> is the log reporter that prints log messages to the console, timestampted with <code>clock</code>. If not provided, the default clock is <a href="#val-default_posix_clock"><code>default_posix_clock</code></a>. <code>level</code> is the default log threshold. It is <code>Logs.Info</code> if not specified.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-no_reporter" class="anchored"><a href="#val-no_reporter" class="anchor"></a><code><span><span class="keyword">val</span> no_reporter : <span><a href="#type-reporter">reporter</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>no_reporter</code> disable log reporting.</p></div></div><h3 id="random"><a href="#random" class="anchor"></a>Random</h3><div class="odoc-spec"><div class="spec type" id="type-random" class="anchored"><a href="#type-random" class="anchor"></a><code><span><span class="keyword">type</span> random</span></code></div><div class="spec-doc"><p>Abstract type for random sources.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-random" class="anchored"><a href="#val-random" class="anchor"></a><code><span><span class="keyword">val</span> random : <span><a href="#type-random">random</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementations of the <code>Mirage_types.RANDOM</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-stdlib_random" class="anchored"><a href="#val-stdlib_random" class="anchor"></a><code><span><span class="keyword">val</span> stdlib_random : <span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Passthrough to the OCaml Random generator.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-nocrypto_random" class="anchored"><a href="#val-nocrypto_random" class="anchor"></a><code><span><span class="keyword">val</span> nocrypto_random : <span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Passthrough to the Fortuna PRNG implemented in nocrypto.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_random" class="anchored"><a href="#val-default_random" class="anchor"></a><code><span><span class="keyword">val</span> default_random : <span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Default PRNG device to be used in unikernels. It uses getrandom/getentropy on Unix, and a Fortuna PRNG on other targets.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-rng" class="anchored"><a href="#val-rng" class="anchor"></a><code><span><span class="keyword">val</span> rng : <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span>?mclock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>rng</code> is the device <code>Mirage_crypto_rng.Make</code>.</p></div></div><h3 id="consoles"><a href="#consoles" class="anchor"></a>Consoles</h3><div class="odoc-spec"><div class="spec type" id="type-console" class="anchored"><a href="#type-console" class="anchor"></a><code><span><span class="keyword">type</span> console</span></code></div><div class="spec-doc"><p>Abstract type for consoles.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-console" class="anchored"><a href="#val-console" class="anchor"></a><code><span><span class="keyword">val</span> console : <span><a href="#type-console">console</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementations of the <code>Mirage_types.CONSOLE</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_console" class="anchored"><a href="#val-default_console" class="anchor"></a><code><span><span class="keyword">val</span> default_console : <span><a href="#type-console">console</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Default console implementation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-custom_console" class="anchored"><a href="#val-custom_console" class="anchor"></a><code><span><span class="keyword">val</span> custom_console : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-console">console</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Custom console implementation.</p></div></div><h3 id="block-devices"><a href="#block-devices" class="anchor"></a>Block devices</h3><div class="odoc-spec"><div class="spec type" id="type-block" class="anchored"><a href="#type-block" class="anchor"></a><code><span><span class="keyword">type</span> block</span></code></div><div class="spec-doc"><p>Abstract type for raw block device configurations.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-block" class="anchored"><a href="#val-block" class="anchor"></a><code><span><span class="keyword">val</span> block : <span><a href="#type-block">block</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementations of the <code>Mirage_types.BLOCK</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-block_of_file" class="anchored"><a href="#val-block_of_file" class="anchor"></a><code><span><span class="keyword">val</span> block_of_file : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Use the given file as a raw block device.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-block_of_xenstore_id" class="anchored"><a href="#val-block_of_xenstore_id" class="anchor"></a><code><span><span class="keyword">val</span> block_of_xenstore_id : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Use the given XenStore ID (ex: <code>/dev/xvdi1</code> or <code>51760</code>) as a raw block device.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-ramdisk" class="anchored"><a href="#val-ramdisk" class="anchor"></a><code><span><span class="keyword">val</span> ramdisk : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Use a ramdisk with the given name.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-generic_block" class="anchored"><a href="#val-generic_block" class="anchor"></a><code><span><span class="keyword">val</span> generic_block : 
  <span>?group:string <span class="arrow">&#45;&gt;</span></span>
  <span>?key:<span><span>[ `XenstoreId <span>| `BlockFile</span> <span>| `Ramdisk</span> ]</span> <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-block">block</a> <a href="#type-impl">impl</a></span></span></code></div></div><h3 id="static-key/value-stores"><a href="#static-key/value-stores" class="anchor"></a>Static key/value stores</h3><div class="odoc-spec"><div class="spec type" id="type-kv_ro" class="anchored"><a href="#type-kv_ro" class="anchor"></a><code><span><span class="keyword">type</span> kv_ro</span></code></div><div class="spec-doc"><p>Abstract type for read-only key/value store.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-kv_ro" class="anchored"><a href="#val-kv_ro" class="anchor"></a><code><span><span class="keyword">val</span> kv_ro : <span><a href="#type-kv_ro">kv_ro</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementations of the <code>Mirage_types.KV_RO</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-crunch" class="anchored"><a href="#val-crunch" class="anchor"></a><code><span><span class="keyword">val</span> crunch : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-kv_ro">kv_ro</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Crunch a directory.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-archive" class="anchored"><a href="#val-archive" class="anchor"></a><code><span><span class="keyword">val</span> archive : <span><span><a href="#type-block">block</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-kv_ro">kv_ro</a> <a href="#type-impl">impl</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-archive_of_files" class="anchored"><a href="#val-archive_of_files" class="anchor"></a><code><span><span class="keyword">val</span> archive_of_files : <span>?dir:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-kv_ro">kv_ro</a> <a href="#type-impl">impl</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-direct_kv_ro" class="anchored"><a href="#val-direct_kv_ro" class="anchor"></a><code><span><span class="keyword">val</span> direct_kv_ro : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-kv_ro">kv_ro</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Direct access to the underlying filesystem as a key/value store. For Xen backends, this is equivalent to <code>crunch</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-generic_kv_ro" class="anchored"><a href="#val-generic_kv_ro" class="anchor"></a><code><span><span class="keyword">val</span> generic_kv_ro : 
  <span>?group:string <span class="arrow">&#45;&gt;</span></span>
  <span>?key:<span><span>[ `Archive <span>| `Crunch</span> <span>| `Direct</span> <span>| `Fat</span> ]</span> <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-kv_ro">kv_ro</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Generic key/value that will choose dynamically between <a href="#val-fat"><code>fat</code></a>, <a href="#val-archive"><code>archive</code></a> and <a href="#val-crunch"><code>crunch</code></a>. To use a filesystem implementation, try <a href="#val-kv_ro_of_fs"><code>kv_ro_of_fs</code></a>.</p><p>If no key is provided, it uses <a href="Key/index.html#val-kv_ro"><code>Key.kv_ro</code></a> to create a new one.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-docteur" class="anchored"><a href="#val-docteur" class="anchor"></a><code><span><span class="keyword">val</span> docteur : 
  <span>?mode:<span>[ `Fast <span>| `Light</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?disk:<span>string <a href="Key/index.html#type-key">Key.key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?analyze:<span>bool <a href="Key/index.html#type-key">Key.key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?branch:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-kv_ro">kv_ro</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>docteur ?mode ?disk ?analyze remote</code> is a read-only, key-value store device. Data is stored on that device using the Git PACK file format, version 2. This format has very good compression factors for many similar files of relatively small size. For instance, 14Gb of HTML files can be compressed into a disk image of 240Mb.</p><p>Unlike <a href="#val-crunch"><code>crunch</code></a>, <code>docteur</code> produces an external image which means that less memory is used to keep and get files. The image can be produced from many sources:</p><ul><li>A local Git repository (like <code>file://path/to/the/git/repository/</code>)</li><li>A simple directory (like <code>file://path/to/a/simple/directory/</code>)</li><li>A remote Git repository (via SSH, HTTP(S) or TCP/IP as what <code>git clone</code> expects)</li></ul><p>If you use a Git repository, you can choose a specific branch with the <code>?branch</code> argument (like <code>refs/heads/main</code>). Otherwise, this argument is ignored.</p><p>For a Solo5 target, users must <i>attach</i> the image as a block device:</p><pre><code>$ solo5-hvt --block:&lt;name&gt;=&lt;path-to-the-image&gt; -- unikernel.{hvt,...} </code></pre><p>For the Unix target, the program <code>open</code> the image at the beginning of the process. An integrity check of the image can be done via the <code>analyze</code> value (defaults to <code>true</code>).</p><p>It's possible to use the file-system into 2 modes:</p><ul><li><code>`Light</code>: any access requires that we reconstruct the path to the requested file. That means that we will need to extract a few additional objects before the extraction of the requested one. <code>`Light</code> does not cache anything in memory but it can be slower if the requested file is deep in the directory structure.</li><li><code>`Fast</code>: reconstructs and cache the layout of the directory structure when the unikernel starts: it might increase boot-time and bigger memory requirements. However, <code>`Fast</code> allows the device to decode only the requested object so it is faster than the <code>`Light</code> mode.</li></ul></div></div><div class="odoc-spec"><div class="spec type" id="type-kv_rw" class="anchored"><a href="#type-kv_rw" class="anchor"></a><code><span><span class="keyword">type</span> kv_rw</span></code></div><div class="spec-doc"><p>Abstract type for read-write key/value store.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-kv_rw" class="anchored"><a href="#val-kv_rw" class="anchor"></a><code><span><span class="keyword">val</span> kv_rw : <span><a href="#type-kv_rw">kv_rw</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementations of the <code>Mirage_types.KV_RW</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-direct_kv_rw" class="anchored"><a href="#val-direct_kv_rw" class="anchor"></a><code><span><span class="keyword">val</span> direct_kv_rw : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-kv_rw">kv_rw</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Direct access to the underlying filesystem as a key/value store. Only available on Unix backends.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-kv_rw_mem" class="anchored"><a href="#val-kv_rw_mem" class="anchor"></a><code><span><span class="keyword">val</span> kv_rw_mem : <span>?clock:<span><a href="#type-pclock">pclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-kv_rw">kv_rw</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>An in-memory key-value store using <code>mirage-kv-mem</code>.</p></div></div><h3 id="filesystem"><a href="#filesystem" class="anchor"></a>Filesystem</h3><div class="odoc-spec"><div class="spec type" id="type-fs" class="anchored"><a href="#type-fs" class="anchor"></a><code><span><span class="keyword">type</span> fs</span></code></div><div class="spec-doc"><p>Abstract type for filesystems.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fs" class="anchored"><a href="#val-fs" class="anchor"></a><code><span><span class="keyword">val</span> fs : <span><a href="#type-fs">fs</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementations of the <code>Mirage_types.FS</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fat" class="anchored"><a href="#val-fat" class="anchor"></a><code><span><span class="keyword">val</span> fat : <span><span><a href="#type-block">block</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-fs">fs</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Consider a raw block device as a FAT filesystem.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fat_of_files" class="anchored"><a href="#val-fat_of_files" class="anchor"></a><code><span><span class="keyword">val</span> fat_of_files : <span>?dir:string <span class="arrow">&#45;&gt;</span></span> <span>?regexp:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-fs">fs</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>fat_files dir ?dir ?regexp ()</code> collects all the files matching the shell pattern <code>regexp</code> in the directory <code>dir</code> into a FAT image. By default, <code>dir</code> is the current working directory and <code>regexp</code> is <i>*</i></p></div></div><div class="odoc-spec"><div class="spec value" id="val-kv_ro_of_fs" class="anchored"><a href="#val-kv_ro_of_fs" class="anchor"></a><code><span><span class="keyword">val</span> kv_ro_of_fs : <span><span><a href="#type-fs">fs</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-kv_ro">kv_ro</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Consider a filesystem implementation as a read-only key/value store.</p></div></div><h3 id="network-interfaces"><a href="#network-interfaces" class="anchor"></a>Network interfaces</h3><div class="odoc-spec"><div class="spec type" id="type-network" class="anchored"><a href="#type-network" class="anchor"></a><code><span><span class="keyword">type</span> network</span></code></div><div class="spec-doc"><p>Abstract type for network configurations.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-network" class="anchored"><a href="#val-network" class="anchor"></a><code><span><span class="keyword">val</span> network : <span><a href="#type-network">network</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementations of the <code>Mirage_types.NETWORK</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_network" class="anchored"><a href="#val-default_network" class="anchor"></a><code><span><span class="keyword">val</span> default_network : <span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>default_network</code> is a dynamic network implementation * which attempts to do something reasonable based on the target.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-netif" class="anchored"><a href="#val-netif" class="anchor"></a><code><span><span class="keyword">val</span> netif : <span>?group:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>A custom network interface. Exposes a <a href="Key/index.html#val-interface"><code>Key.interface</code></a> key.</p></div></div><h3 id="ethernet-configuration"><a href="#ethernet-configuration" class="anchor"></a>Ethernet configuration</h3><div class="odoc-spec"><div class="spec type" id="type-ethernet" class="anchored"><a href="#type-ethernet" class="anchor"></a><code><span><span class="keyword">type</span> ethernet</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-ethernet" class="anchored"><a href="#val-ethernet" class="anchor"></a><code><span><span class="keyword">val</span> ethernet : <span><a href="#type-ethernet">ethernet</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementations of the <code>Mirage_types.ETHERNET</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-etif" class="anchored"><a href="#val-etif" class="anchor"></a><code><span><span class="keyword">val</span> etif : <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-ethernet">ethernet</a> <a href="#type-impl">impl</a></span></span></code></div></div><h3 id="arp-configuration"><a href="#arp-configuration" class="anchor"></a>ARP configuration</h3><div class="odoc-spec"><div class="spec type" id="type-arpv4" class="anchored"><a href="#type-arpv4" class="anchor"></a><code><span><span class="keyword">type</span> arpv4</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-arpv4" class="anchored"><a href="#val-arpv4" class="anchor"></a><code><span><span class="keyword">val</span> arpv4 : <span><a href="#type-arpv4">arpv4</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementation of the <code>Mirage_types.ARPV4</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-arp" class="anchored"><a href="#val-arp" class="anchor"></a><code><span><span class="keyword">val</span> arp : <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-ethernet">ethernet</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-arpv4">arpv4</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>ARP implementation provided by the arp library</p></div></div><h3 id="ip-configuration"><a href="#ip-configuration" class="anchor"></a>IP configuration</h3><p>Implementations of the <code>Mirage_types.IP</code> signature.</p><div class="odoc-spec"><div class="spec type" id="type-v4" class="anchored"><a href="#type-v4" class="anchor"></a><code><span><span class="keyword">type</span> v4</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-v6" class="anchored"><a href="#type-v6" class="anchor"></a><code><span><span class="keyword">type</span> v6</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-v4v6" class="anchored"><a href="#type-v4v6" class="anchor"></a><code><span><span class="keyword">type</span> v4v6</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-ip" class="anchored"><a href="#type-ip" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a ip</span></span></code></div><div class="spec-doc"><p>Abstract type for IP configurations.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-ipv4" class="anchored"><a href="#type-ipv4" class="anchor"></a><code><span><span class="keyword">type</span> ipv4</span><span> = <span><a href="#type-v4">v4</a> <a href="#type-ip">ip</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-ipv6" class="anchored"><a href="#type-ipv6" class="anchor"></a><code><span><span class="keyword">type</span> ipv6</span><span> = <span><a href="#type-v6">v6</a> <a href="#type-ip">ip</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-ipv4v6" class="anchored"><a href="#type-ipv4v6" class="anchor"></a><code><span><span class="keyword">type</span> ipv4v6</span><span> = <span><a href="#type-v4v6">v4v6</a> <a href="#type-ip">ip</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-ipv4" class="anchored"><a href="#val-ipv4" class="anchor"></a><code><span><span class="keyword">val</span> ipv4 : <span><a href="#type-ipv4">ipv4</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>The <code>Mirage_types.IPV4</code> module signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-ipv6" class="anchored"><a href="#val-ipv6" class="anchor"></a><code><span><span class="keyword">val</span> ipv6 : <span><a href="#type-ipv6">ipv6</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>The <code>Mirage_types.IPV6</code> module signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-ipv4v6" class="anchored"><a href="#val-ipv4v6" class="anchor"></a><code><span><span class="keyword">val</span> ipv4v6 : <span><a href="#type-ipv4v6">ipv4v6</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>The <code>Mirage_types.IP</code> module signature with ipaddr = Ipaddr.t.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-ipv4_config" class="anchored"><a href="#type-ipv4_config" class="anchor"></a><code><span><span class="keyword">type</span> ipv4_config</span><span> = </span><span>{</span></code><table><tr id="type-ipv4_config.network" class="anchored"><td class="def record field"><a href="#type-ipv4_config.network" class="anchor"></a><code><span>network : <span class="xref-unresolved">Ipaddr</span>.V4.Prefix.t;</span></code></td></tr><tr id="type-ipv4_config.gateway" class="anchored"><td class="def record field"><a href="#type-ipv4_config.gateway" class="anchor"></a><code><span>gateway : <span><span class="xref-unresolved">Ipaddr</span>.V4.t option</span>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>Types for manual IPv4 configuration.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-ipv6_config" class="anchored"><a href="#type-ipv6_config" class="anchor"></a><code><span><span class="keyword">type</span> ipv6_config</span><span> = </span><span>{</span></code><table><tr id="type-ipv6_config.network" class="anchored"><td class="def record field"><a href="#type-ipv6_config.network" class="anchor"></a><code><span>network : <span class="xref-unresolved">Ipaddr</span>.V6.Prefix.t;</span></code></td></tr><tr id="type-ipv6_config.gateway" class="anchored"><td class="def record field"><a href="#type-ipv6_config.gateway" class="anchor"></a><code><span>gateway : <span><span class="xref-unresolved">Ipaddr</span>.V6.t option</span>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>Types for manual IPv6 configuration.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create_ipv4" class="anchored"><a href="#val-create_ipv4" class="anchor"></a><code><span><span class="keyword">val</span> create_ipv4 : 
  <span>?group:string <span class="arrow">&#45;&gt;</span></span>
  <span>?config:<a href="#type-ipv4_config">ipv4_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?no_init:<span>bool <a href="Key/index.html#type-key">Key.key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?random:<span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?clock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-ethernet">ethernet</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-arpv4">arpv4</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-ipv4">ipv4</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Use an IPv4 address Exposes the keys <a href="../Mirage_key/V4/index.html#val-network"><code>Key.V4.network</code></a> and <a href="../Mirage_key/V4/index.html#val-gateway"><code>Key.V4.gateway</code></a>. If provided, the values of these keys will override those supplied in the ipv4 configuration record, if that has been provided.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-ipv4_qubes" class="anchored"><a href="#val-ipv4_qubes" class="anchor"></a><code><span><span class="keyword">val</span> ipv4_qubes : 
  <span>?random:<span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?clock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-qubesdb">qubesdb</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-ethernet">ethernet</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-arpv4">arpv4</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-ipv4">ipv4</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Use a given initialized QubesDB to look up and configure the appropriate * IPv4 interface.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create_ipv6" class="anchored"><a href="#val-create_ipv6" class="anchor"></a><code><span><span class="keyword">val</span> create_ipv6 : 
  <span>?random:<span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?clock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?group:string <span class="arrow">&#45;&gt;</span></span>
  <span>?config:<a href="#type-ipv6_config">ipv6_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?no_init:<span>bool <a href="Key/index.html#type-key">Key.key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-ethernet">ethernet</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-ipv6">ipv6</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Use an IPv6 address. Exposes the keys <a href="../Mirage_key/V6/index.html#val-network"><code>Key.V6.network</code></a>, <a href="../Mirage_key/V6/index.html#val-gateway"><code>Key.V6.gateway</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create_ipv4v6" class="anchored"><a href="#val-create_ipv4v6" class="anchor"></a><code><span><span class="keyword">val</span> create_ipv4v6 : <span>?group:string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-ipv4">ipv4</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-ipv6">ipv6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-ipv4v6">ipv4v6</a> <a href="#type-impl">impl</a></span></span></code></div></div><h3 id="udp-configuration"><a href="#udp-configuration" class="anchor"></a>UDP configuration</h3><div class="odoc-spec"><div class="spec type" id="type-udp" class="anchored"><a href="#type-udp" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a udp</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-udpv4" class="anchored"><a href="#type-udpv4" class="anchor"></a><code><span><span class="keyword">type</span> udpv4</span><span> = <span><a href="#type-v4">v4</a> <a href="#type-udp">udp</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-udpv6" class="anchored"><a href="#type-udpv6" class="anchor"></a><code><span><span class="keyword">type</span> udpv6</span><span> = <span><a href="#type-v6">v6</a> <a href="#type-udp">udp</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-udpv4v6" class="anchored"><a href="#type-udpv4v6" class="anchor"></a><code><span><span class="keyword">type</span> udpv4v6</span><span> = <span><a href="#type-v4v6">v4v6</a> <a href="#type-udp">udp</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-udp" class="anchored"><a href="#val-udp" class="anchor"></a><code><span><span class="keyword">val</span> udp : <span><span><span class="type-var">'a</span> <a href="#type-udp">udp</a></span> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementation of the <code>Mirage_types.UDP</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-udpv4" class="anchored"><a href="#val-udpv4" class="anchor"></a><code><span><span class="keyword">val</span> udpv4 : <span><a href="#type-udpv4">udpv4</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-udpv6" class="anchored"><a href="#val-udpv6" class="anchor"></a><code><span><span class="keyword">val</span> udpv6 : <span><a href="#type-udpv6">udpv6</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-udpv4v6" class="anchored"><a href="#val-udpv4v6" class="anchor"></a><code><span><span class="keyword">val</span> udpv4v6 : <span><a href="#type-udpv4v6">udpv4v6</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-direct_udp" class="anchored"><a href="#val-direct_udp" class="anchor"></a><code><span><span class="keyword">val</span> direct_udp : <span>?random:<span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span><span class="type-var">'a</span> <a href="#type-ip">ip</a></span> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-udp">udp</a></span> <a href="#type-impl">impl</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-socket_udpv4" class="anchored"><a href="#val-socket_udpv4" class="anchor"></a><code><span><span class="keyword">val</span> socket_udpv4 : <span>?group:string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="xref-unresolved">Ipaddr</span>.V4.t option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-udpv4">udpv4</a> <a href="#type-impl">impl</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-socket_udpv6" class="anchored"><a href="#val-socket_udpv6" class="anchor"></a><code><span><span class="keyword">val</span> socket_udpv6 : <span>?group:string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="xref-unresolved">Ipaddr</span>.V6.t option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-udpv6">udpv6</a> <a href="#type-impl">impl</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-socket_udpv4v6" class="anchored"><a href="#val-socket_udpv4v6" class="anchor"></a><code><span><span class="keyword">val</span> socket_udpv4v6 : 
  <span>?group:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Ipaddr</span>.V4.t option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Ipaddr</span>.V6.t option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-udpv4v6">udpv4v6</a> <a href="#type-impl">impl</a></span></span></code></div></div><h3 id="tcp-configuration"><a href="#tcp-configuration" class="anchor"></a>TCP configuration</h3><div class="odoc-spec"><div class="spec type" id="type-tcp" class="anchored"><a href="#type-tcp" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a tcp</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-tcpv4" class="anchored"><a href="#type-tcpv4" class="anchor"></a><code><span><span class="keyword">type</span> tcpv4</span><span> = <span><a href="#type-v4">v4</a> <a href="#type-tcp">tcp</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-tcpv6" class="anchored"><a href="#type-tcpv6" class="anchor"></a><code><span><span class="keyword">type</span> tcpv6</span><span> = <span><a href="#type-v6">v6</a> <a href="#type-tcp">tcp</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-tcpv4v6" class="anchored"><a href="#type-tcpv4v6" class="anchor"></a><code><span><span class="keyword">type</span> tcpv4v6</span><span> = <span><a href="#type-v4v6">v4v6</a> <a href="#type-tcp">tcp</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tcp" class="anchored"><a href="#val-tcp" class="anchor"></a><code><span><span class="keyword">val</span> tcp : <span><span><span class="type-var">'a</span> <a href="#type-tcp">tcp</a></span> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementation of the <code>Mirage_types.TCP</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tcpv4" class="anchored"><a href="#val-tcpv4" class="anchor"></a><code><span><span class="keyword">val</span> tcpv4 : <span><a href="#type-tcpv4">tcpv4</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tcpv6" class="anchored"><a href="#val-tcpv6" class="anchor"></a><code><span><span class="keyword">val</span> tcpv6 : <span><a href="#type-tcpv6">tcpv6</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tcpv4v6" class="anchored"><a href="#val-tcpv4v6" class="anchor"></a><code><span><span class="keyword">val</span> tcpv4v6 : <span><a href="#type-tcpv4v6">tcpv4v6</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-direct_tcp" class="anchored"><a href="#val-direct_tcp" class="anchor"></a><code><span><span class="keyword">val</span> direct_tcp : 
  <span>?mclock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?random:<span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span class="type-var">'a</span> <a href="#type-ip">ip</a></span> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-tcp">tcp</a></span> <a href="#type-impl">impl</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-socket_tcpv4" class="anchored"><a href="#val-socket_tcpv4" class="anchor"></a><code><span><span class="keyword">val</span> socket_tcpv4 : <span>?group:string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="xref-unresolved">Ipaddr</span>.V4.t option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tcpv4">tcpv4</a> <a href="#type-impl">impl</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-socket_tcpv6" class="anchored"><a href="#val-socket_tcpv6" class="anchor"></a><code><span><span class="keyword">val</span> socket_tcpv6 : <span>?group:string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="xref-unresolved">Ipaddr</span>.V6.t option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tcpv6">tcpv6</a> <a href="#type-impl">impl</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-socket_tcpv4v6" class="anchored"><a href="#val-socket_tcpv4v6" class="anchor"></a><code><span><span class="keyword">val</span> socket_tcpv4v6 : 
  <span>?group:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Ipaddr</span>.V4.t option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Ipaddr</span>.V6.t option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tcpv4v6">tcpv4v6</a> <a href="#type-impl">impl</a></span></span></code></div></div><h3 id="network-stack-configuration"><a href="#network-stack-configuration" class="anchor"></a>Network stack configuration</h3><div class="odoc-spec"><div class="spec type" id="type-stackv4" class="anchored"><a href="#type-stackv4" class="anchor"></a><code><span><span class="keyword">type</span> stackv4</span></code></div><div class="spec-doc"><p>IPv4</p></div></div><div class="odoc-spec"><div class="spec value" id="val-stackv4" class="anchored"><a href="#val-stackv4" class="anchor"></a><code><span><span class="keyword">val</span> stackv4 : <span><a href="#type-stackv4">stackv4</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementation of the <code>Mirage_types.STACKV4</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-direct_stackv4" class="anchored"><a href="#val-direct_stackv4" class="anchor"></a><code><span><span class="keyword">val</span> direct_stackv4 : 
  <span>?mclock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?random:<span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-ethernet">ethernet</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-arpv4">arpv4</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-ipv4">ipv4</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-stackv4">stackv4</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Direct network stack with given ip.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-socket_stackv4" class="anchored"><a href="#val-socket_stackv4" class="anchor"></a><code><span><span class="keyword">val</span> socket_stackv4 : <span>?group:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-stackv4">stackv4</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Network stack with sockets.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-qubes_ipv4_stack" class="anchored"><a href="#val-qubes_ipv4_stack" class="anchor"></a><code><span><span class="keyword">val</span> qubes_ipv4_stack : 
  <span>?qubesdb:<span><a href="#type-qubesdb">qubesdb</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?arp:<span>( <span><span><a href="#type-ethernet">ethernet</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-arpv4">arpv4</a> <a href="#type-impl">impl</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-stackv4">stackv4</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Build a stackv4 by looking up configuration information via QubesDB, * building an ipv4, then building a stack on top of that.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dhcp_ipv4_stack" class="anchored"><a href="#val-dhcp_ipv4_stack" class="anchor"></a><code><span><span class="keyword">val</span> dhcp_ipv4_stack : 
  <span>?random:<span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?clock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?arp:<span>( <span><span><a href="#type-ethernet">ethernet</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-arpv4">arpv4</a> <a href="#type-impl">impl</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-stackv4">stackv4</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Build a stackv4 by obtaining a DHCP lease, using the lease to * build an ipv4, then building a stack on top of that.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-static_ipv4_stack" class="anchored"><a href="#val-static_ipv4_stack" class="anchor"></a><code><span><span class="keyword">val</span> static_ipv4_stack : 
  <span>?group:string <span class="arrow">&#45;&gt;</span></span>
  <span>?config:<a href="#type-ipv4_config">ipv4_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?arp:<span>( <span><span><a href="#type-ethernet">ethernet</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-arpv4">arpv4</a> <a href="#type-impl">impl</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-stackv4">stackv4</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Build a stackv4 by checking the <a href="../Mirage_key/V4/index.html#val-network"><code>Key.V4.network</code></a>, and <a href="../Mirage_key/V4/index.html#val-gateway"><code>Key.V4.gateway</code></a> keys * for ipv4 configuration information, filling in unspecified information from <code>?config</code>, * then building a stack on top of that.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-generic_stackv4" class="anchored"><a href="#val-generic_stackv4" class="anchor"></a><code><span><span class="keyword">val</span> generic_stackv4 : 
  <span>?group:string <span class="arrow">&#45;&gt;</span></span>
  <span>?config:<a href="#type-ipv4_config">ipv4_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?dhcp_key:<span>bool <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?net_key:<span><span><span>[ `Direct <span>| `Socket</span> ]</span> option</span> <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-stackv4">stackv4</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Generic stack using a <code>dhcp</code> and a <code>net</code> keys: <a href="Key/index.html#val-net"><code>Key.net</code></a> and <a href="Key/index.html#val-dhcp"><code>Key.dhcp</code></a>.</p><ul><li>If <code>target</code> = <code>Qubes</code> then <a href="#val-qubes_ipv4_stack"><code>qubes_ipv4_stack</code></a> is used</li><li>Else, if <code>net</code> = <code>socket</code> then <a href="#val-socket_stackv4"><code>socket_stackv4</code></a> is used</li><li>Else, if <code>dhcp</code> then <a href="#val-dhcp_ipv4_stack"><code>dhcp_ipv4_stack</code></a> is used</li><li>Else, if <code>unix or macosx</code> then <a href="#val-socket_stackv4"><code>socket_stackv4</code></a> is used</li><li>Else, <a href="#val-static_ipv4_stack"><code>static_ipv4_stack</code></a> is used.</li></ul><p>If a key is not provided, it uses <a href="Key/index.html#val-net"><code>Key.net</code></a> or <a href="Key/index.html#val-dhcp"><code>Key.dhcp</code></a> (with the <code>group</code> argument) to create it.</p></div></div><h4 id="ipv6"><a href="#ipv6" class="anchor"></a>IPv6</h4><div class="odoc-spec"><div class="spec type" id="type-stackv6" class="anchored"><a href="#type-stackv6" class="anchor"></a><code><span><span class="keyword">type</span> stackv6</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-stackv6" class="anchored"><a href="#val-stackv6" class="anchor"></a><code><span><span class="keyword">val</span> stackv6 : <span><a href="#type-stackv6">stackv6</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementation of the <code>Mirage_stack.V6</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-direct_stackv6" class="anchored"><a href="#val-direct_stackv6" class="anchor"></a><code><span><span class="keyword">val</span> direct_stackv6 : 
  <span>?mclock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?random:<span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-ethernet">ethernet</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-ipv6">ipv6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-stackv6">stackv6</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Direct network stack with given ip.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-socket_stackv6" class="anchored"><a href="#val-socket_stackv6" class="anchor"></a><code><span><span class="keyword">val</span> socket_stackv6 : <span>?group:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-stackv6">stackv6</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Network stack with sockets.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-static_ipv6_stack" class="anchored"><a href="#val-static_ipv6_stack" class="anchor"></a><code><span><span class="keyword">val</span> static_ipv6_stack : 
  <span>?group:string <span class="arrow">&#45;&gt;</span></span>
  <span>?config:<a href="#type-ipv6_config">ipv6_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-stackv6">stackv6</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Build a stackv6 by checking the <a href="../Mirage_key/V6/index.html#val-network"><code>Key.V6.network</code></a>, and <a href="../Mirage_key/V6/index.html#val-gateway"><code>Key.V6.gateway</code></a> keys for ipv6 configuration information, filling in unspecified information from <code>?config</code>, then building a stack on top of that.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-generic_stackv6" class="anchored"><a href="#val-generic_stackv6" class="anchor"></a><code><span><span class="keyword">val</span> generic_stackv6 : 
  <span>?group:string <span class="arrow">&#45;&gt;</span></span>
  <span>?config:<a href="#type-ipv6_config">ipv6_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?net_key:<span><span><span>[ `Direct <span>| `Socket</span> ]</span> option</span> <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-stackv6">stackv6</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Generic stack using a <code>net</code> keys: <a href="Key/index.html#val-net"><code>Key.net</code></a>.</p><ul><li>If <code>net</code> = <code>socket</code> then <a href="#val-socket_stackv6"><code>socket_stackv6</code></a> is used</li><li>Else, if <code>unix or macosx</code> then <a href="#val-socket_stackv6"><code>socket_stackv6</code></a> is used</li><li>Else, <a href="#val-static_ipv6_stack"><code>static_ipv6_stack</code></a> is used.</li></ul><p>If a key is not provided, it uses <a href="Key/index.html#val-net"><code>Key.net</code></a> (with the <code>group</code> argument) to create it.</p></div></div><h4 id="dual-ipv4-and-ipv6"><a href="#dual-ipv4-and-ipv6" class="anchor"></a>Dual IPv4 and IPv6</h4><div class="odoc-spec"><div class="spec type" id="type-stackv4v6" class="anchored"><a href="#type-stackv4v6" class="anchor"></a><code><span><span class="keyword">type</span> stackv4v6</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-stackv4v6" class="anchored"><a href="#val-stackv4v6" class="anchor"></a><code><span><span class="keyword">val</span> stackv4v6 : <span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementation of the <code>Mirage_stack.V4V6</code> signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-direct_stackv4v6" class="anchored"><a href="#val-direct_stackv4v6" class="anchor"></a><code><span><span class="keyword">val</span> direct_stackv4v6 : 
  <span>?mclock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?random:<span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>ipv4_only:<span>bool <a href="Key/index.html#type-key">Key.key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>ipv6_only:<span>bool <a href="Key/index.html#type-key">Key.key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-ethernet">ethernet</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-arpv4">arpv4</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-ipv4">ipv4</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-ipv6">ipv6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Direct network stack with given ip.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-socket_stackv4v6" class="anchored"><a href="#val-socket_stackv4v6" class="anchor"></a><code><span><span class="keyword">val</span> socket_stackv4v6 : <span>?group:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Network stack with sockets.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-static_ipv4v6_stack" class="anchored"><a href="#val-static_ipv4v6_stack" class="anchor"></a><code><span><span class="keyword">val</span> static_ipv4v6_stack : 
  <span>?group:string <span class="arrow">&#45;&gt;</span></span>
  <span>?ipv6_config:<a href="#type-ipv6_config">ipv6_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?ipv4_config:<a href="#type-ipv4_config">ipv4_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?arp:<span>( <span><span><a href="#type-ethernet">ethernet</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-arpv4">arpv4</a> <a href="#type-impl">impl</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Build a stackv4v6 by checking the <a href="../Mirage_key/V6/index.html#val-network"><code>Key.V6.network</code></a>, and <a href="../Mirage_key/V6/index.html#val-gateway"><code>Key.V6.gateway</code></a> keys for IPv4 and IPv6 configuration information, filling in unspecified information from <code>?config</code>, then building a stack on top of that.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-generic_stackv4v6" class="anchored"><a href="#val-generic_stackv4v6" class="anchor"></a><code><span><span class="keyword">val</span> generic_stackv4v6 : 
  <span>?group:string <span class="arrow">&#45;&gt;</span></span>
  <span>?ipv6_config:<a href="#type-ipv6_config">ipv6_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?ipv4_config:<a href="#type-ipv4_config">ipv4_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?dhcp_key:<span>bool <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?net_key:<span><span><span>[ `Direct <span>| `Socket</span> ]</span> option</span> <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-network">network</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Generic stack using a <code>net</code> keys: <a href="Key/index.html#val-net"><code>Key.net</code></a>.</p><ul><li>If <code>net</code> = <code>socket</code> then <a href="#val-socket_stackv4v6"><code>socket_stackv4v6</code></a> is used</li><li>Else, if <code>unix or macosx</code> then <a href="#val-socket_stackv4v6"><code>socket_stackv4v6</code></a> is used</li><li>Else, <a href="#val-static_ipv4v6_stack"><code>static_ipv4v6_stack</code></a> is used.</li></ul><p>If a key is not provided, it uses <a href="Key/index.html#val-net"><code>Key.net</code></a> (with the <code>group</code> argument) to create it.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tcpv4v6_of_stackv4v6" class="anchored"><a href="#val-tcpv4v6_of_stackv4v6" class="anchor"></a><code><span><span class="keyword">val</span> tcpv4v6_of_stackv4v6 : <span><span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tcpv4v6">tcpv4v6</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>tcpv4v6 stackv4v6</code> is an helper to extract the TCP/IP stack regardless the UDP/IP stack expected by some <i>devices</i> such as protocols.</p></div></div><h3 id="resolver-configuration"><a href="#resolver-configuration" class="anchor"></a>Resolver configuration</h3><div class="odoc-spec"><div class="spec type" id="type-resolver" class="anchored"><a href="#type-resolver" class="anchor"></a><code><span><span class="keyword">type</span> resolver</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-resolver" class="anchored"><a href="#val-resolver" class="anchor"></a><code><span><span class="keyword">val</span> resolver : <span><a href="#type-resolver">resolver</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-resolver_dns" class="anchored"><a href="#val-resolver_dns" class="anchor"></a><code><span><span class="keyword">val</span> resolver_dns : 
  <span>?ns:<span class="xref-unresolved">Ipaddr</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span>?ns_port:int <span class="arrow">&#45;&gt;</span></span>
  <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?mclock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?pclock:<span><a href="#type-pclock">pclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?random:<span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-resolver">resolver</a> <a href="#type-impl">impl</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-resolver_unix_system" class="anchored"><a href="#val-resolver_unix_system" class="anchor"></a><code><span><span class="keyword">val</span> resolver_unix_system : <span><a href="#type-resolver">resolver</a> <a href="#type-impl">impl</a></span></span></code></div></div><h3 id="dns-client"><a href="#dns-client" class="anchor"></a>DNS client</h3><p>A DNS client is a module which implements:</p><ul><li><code>getaddrinfo</code> to request a <code>query_type</code>-dependent response to a nameserver regarding a domain-name such as the <code>MX</code> record.</li><li><code>gethostbyname</code> to request the <code>A</code> regarding a domain-name</li><li><code>gethostbyname6</code> to request the <code>AAAA</code> record regarding a domain-name</li></ul><div class="odoc-spec"><div class="spec type" id="type-dns_client" class="anchored"><a href="#type-dns_client" class="anchor"></a><code><span><span class="keyword">type</span> dns_client</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-dns_client" class="anchored"><a href="#val-dns_client" class="anchor"></a><code><span><span class="keyword">val</span> dns_client : <span><a href="#type-dns_client">dns_client</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-generic_dns_client" class="anchored"><a href="#val-generic_dns_client" class="anchor"></a><code><span><span class="keyword">val</span> generic_dns_client : 
  <span>?timeout:<span><span>int64 option</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?nameservers:<span><span>string list</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?random:<span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?mclock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?pclock:<span><a href="#type-pclock">pclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-dns_client">dns_client</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>generic_dns_client stackv4v6</code> creates a new DNS value which is able to resolve domain-name from <code>nameservers</code>. It requires a network stack to communicate with these nameservers.</p></div></div><h3 id="happy-eyeballs"><a href="#happy-eyeballs" class="anchor"></a>Happy-eyeballs</h3><p>Happy-eyeballs is an implementation of RFC 8305 which specifies how to connect to a remote host using either IP protocol version 4 or IP protocol version 6 from a <code>stackv4v6</code> network implementation.</p><p>The given <i>device</i> is able to resolve a remote host <i>via</i> a <a href="#val-dns_client"><code>dns_client</code></a> device and both must share the same <code>stackv4v6</code> implementation.</p><div class="odoc-spec"><div class="spec type" id="type-happy_eyeballs" class="anchored"><a href="#type-happy_eyeballs" class="anchor"></a><code><span><span class="keyword">type</span> happy_eyeballs</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-happy_eyeballs" class="anchored"><a href="#val-happy_eyeballs" class="anchor"></a><code><span><span class="keyword">val</span> happy_eyeballs : <span><a href="#type-happy_eyeballs">happy_eyeballs</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-generic_happy_eyeballs" class="anchored"><a href="#val-generic_happy_eyeballs" class="anchor"></a><code><span><span class="keyword">val</span> generic_happy_eyeballs : 
  <span>?aaaa_timeout:<span><span>int64 option</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?v6_connect_timeout:<span><span>int64 option</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?connect_timeout:<span><span>int64 option</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?resolve_timeout:<span><span>int64 option</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?resolve_retries:<span><span>int64 option</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?timer_interval:<span><span>int64 option</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?mclock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-dns_client">dns_client</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-happy_eyeballs">happy_eyeballs</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>generic_happy_eyeballs stackv4v6 dns_client</code> creates a new happy-eyeballs value which is able to resolve and connect to a remote host and allocate finally a connected <i>flow</i> from the given network implementation <code>stackv4v6</code>.</p><p>This device has several optional arguments of keys for timeouts specified in nanoseconds.</p></div></div><h3 id="syslog-configuration"><a href="#syslog-configuration" class="anchor"></a>Syslog configuration</h3><p>Syslog exfiltrates log messages (generated by libraries using the <code>logs</code> library) via a network connection. The log level of the log sources is controlled via the <a href="../Mirage_key/index.html#val-logs"><code>Mirage_key.logs</code></a> key. The functionality is provided by the <code>logs-syslog</code> package.</p><div class="odoc-spec"><div class="spec type" id="type-syslog_config" class="anchored"><a href="#type-syslog_config" class="anchor"></a><code><span><span class="keyword">type</span> syslog_config</span><span> = </span><span>{</span></code><table><tr id="type-syslog_config.hostname" class="anchored"><td class="def record field"><a href="#type-syslog_config.hostname" class="anchor"></a><code><span>hostname : string;</span></code></td></tr><tr id="type-syslog_config.server" class="anchored"><td class="def record field"><a href="#type-syslog_config.server" class="anchor"></a><code><span>server : <span><span class="xref-unresolved">Ipaddr</span>.t option</span>;</span></code></td></tr><tr id="type-syslog_config.port" class="anchored"><td class="def record field"><a href="#type-syslog_config.port" class="anchor"></a><code><span>port : <span>int option</span>;</span></code></td></tr><tr id="type-syslog_config.truncate" class="anchored"><td class="def record field"><a href="#type-syslog_config.truncate" class="anchor"></a><code><span>truncate : <span>int option</span>;</span></code></td></tr></table><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-syslog_config" class="anchored"><a href="#val-syslog_config" class="anchor"></a><code><span><span class="keyword">val</span> syslog_config : 
  <span>?port:int <span class="arrow">&#45;&gt;</span></span>
  <span>?truncate:int <span class="arrow">&#45;&gt;</span></span>
  <span>?server:<span class="xref-unresolved">Ipaddr</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-syslog_config">syslog_config</a></span></code></div><div class="spec-doc"><p>Helper for constructing a <a href="#type-syslog_config"><code>syslog_config</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-syslog" class="anchored"><a href="#type-syslog" class="anchor"></a><code><span><span class="keyword">type</span> syslog</span></code></div><div class="spec-doc"><p>The type for syslog</p></div></div><div class="odoc-spec"><div class="spec value" id="val-syslog" class="anchored"><a href="#val-syslog" class="anchor"></a><code><span><span class="keyword">val</span> syslog : <span><a href="#type-syslog">syslog</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p>Implementation of the <a href="#type-syslog"><code>syslog</code></a> type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-syslog_udp" class="anchored"><a href="#val-syslog_udp" class="anchor"></a><code><span><span class="keyword">val</span> syslog_udp : 
  <span>?config:<a href="#type-syslog_config">syslog_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?console:<span><a href="#type-console">console</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?clock:<span><a href="#type-pclock">pclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-syslog">syslog</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Emit log messages via UDP to the configured host.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-syslog_tcp" class="anchored"><a href="#val-syslog_tcp" class="anchor"></a><code><span><span class="keyword">val</span> syslog_tcp : 
  <span>?config:<a href="#type-syslog_config">syslog_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?console:<span><a href="#type-console">console</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?clock:<span><a href="#type-pclock">pclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-syslog">syslog</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Emit log messages via TCP to the configured host.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-syslog_tls" class="anchored"><a href="#val-syslog_tls" class="anchor"></a><code><span><span class="keyword">val</span> syslog_tls : 
  <span>?config:<a href="#type-syslog_config">syslog_config</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?keyname:string <span class="arrow">&#45;&gt;</span></span>
  <span>?console:<span><a href="#type-console">console</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?clock:<span><a href="#type-pclock">pclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-kv_ro">kv_ro</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-syslog">syslog</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Emit log messages via TLS to the configured host, using the credentials (private key, certificate, trust anchor) provided in the KV_RO using the <code>keyname</code>.</p></div></div><h3 id="entropy"><a href="#entropy" class="anchor"></a>Entropy</h3><div class="odoc-spec"><div class="spec value" id="val-nocrypto" class="anchored"><a href="#val-nocrypto" class="anchor"></a><code><span><span class="keyword">val</span> nocrypto : <span><a href="#type-job">job</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p>Device that initializes the entropy.</p></div></div><h3 id="conduit-configuration"><a href="#conduit-configuration" class="anchor"></a>Conduit configuration</h3><div class="odoc-spec"><div class="spec type" id="type-conduit" class="anchored"><a href="#type-conduit" class="anchor"></a><code><span><span class="keyword">type</span> conduit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-conduit" class="anchored"><a href="#val-conduit" class="anchor"></a><code><span><span class="keyword">val</span> conduit : <span><a href="#type-conduit">conduit</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-conduit_direct" class="anchored"><a href="#val-conduit_direct" class="anchor"></a><code><span><span class="keyword">val</span> conduit_direct : 
  <span>?tls:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?random:<span><a href="#type-random">random</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-conduit">conduit</a> <a href="#type-impl">impl</a></span></span></code></div></div><h3 id="http-configuration"><a href="#http-configuration" class="anchor"></a>HTTP configuration</h3><div class="odoc-spec"><div class="spec type" id="type-http" class="anchored"><a href="#type-http" class="anchor"></a><code><span><span class="keyword">type</span> http</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-http" class="anchored"><a href="#val-http" class="anchor"></a><code><span><span class="keyword">val</span> http : <span><a href="#type-http">http</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-http_server" class="anchored"><a href="#val-http_server" class="anchor"></a><code><span><span class="keyword">val</span> http_server : <span><span><a href="#type-conduit">conduit</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-http">http</a> <a href="#type-impl">impl</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-cohttp_server" class="anchored"><a href="#val-cohttp_server" class="anchor"></a><code><span><span class="keyword">val</span> cohttp_server : <span><span><a href="#type-conduit">conduit</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-http">http</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>cohttp_server</code> starts a Cohttp server.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-httpaf_server" class="anchored"><a href="#val-httpaf_server" class="anchor"></a><code><span><span class="keyword">val</span> httpaf_server : <span><span><a href="#type-conduit">conduit</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-http">http</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>httpaf_server</code> starts a http/af server.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-http_client" class="anchored"><a href="#type-http_client" class="anchor"></a><code><span><span class="keyword">type</span> http_client</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-http_client" class="anchored"><a href="#val-http_client" class="anchor"></a><code><span><span class="keyword">val</span> http_client : <span><a href="#type-http_client">http_client</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-cohttp_client" class="anchored"><a href="#val-cohttp_client" class="anchor"></a><code><span><span class="keyword">val</span> cohttp_client : 
  <span>?pclock:<span><a href="#type-pclock">pclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-resolver">resolver</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-conduit">conduit</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-http_client">http_client</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>cohttp_server</code> starts a Cohttp server.</p></div></div><h3 id="argv-configuration"><a href="#argv-configuration" class="anchor"></a>Argv configuration</h3><div class="odoc-spec"><div class="spec type" id="type-argv" class="anchored"><a href="#type-argv" class="anchor"></a><code><span><span class="keyword">type</span> argv</span><span> = <a href="../../functoria/Functoria/index.html#type-argv">Functoria.argv</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-argv" class="anchored"><a href="#val-argv" class="anchor"></a><code><span><span class="keyword">val</span> argv : <span><a href="#type-argv">argv</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-default_argv" class="anchored"><a href="#val-default_argv" class="anchor"></a><code><span><span class="keyword">val</span> default_argv : <span><a href="#type-argv">argv</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>default_argv</code> is a dynamic argv implementation * which attempts to do something reasonable based on the target.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-no_argv" class="anchored"><a href="#val-no_argv" class="anchor"></a><code><span><span class="keyword">val</span> no_argv : <span><a href="#type-argv">argv</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>no_argv</code> Disable command line parsing and set argv to <code>|&quot;&quot;|</code>.</p></div></div><h3 id="git-client-configuration"><a href="#git-client-configuration" class="anchor"></a>Git client configuration</h3><p>Users can connect to a remote Git repository in many ways:</p><ul><li>TCP/IP</li><li>HTTP</li><li>HTTP + TLS</li><li>SSH</li></ul><p>The devices defined below define these in composable ways. The <code>git_client impl</code> returned from them can be passed to Git or Irmin in order to be able to <i>fetch</i> and <i>push</i> from/into a Git repository.</p><p>The user is able to restrict or enlarge protocol possibilities needed for its application. For instance, the user is able to restrict only the SSH connection to communicate with a Git repository or the user can handle TCP/IP and SSH as possible protocols to communicate with a peer.</p><p>For instance, a device which is able to communicate <i>via</i> TCP/IP and SSH can be implemented like:</p><pre><code>let git_client =
  let dns = happy_eyeballs stackv4v6 in
  let ssh = git_ssh ~key (tcpv4v6_of_stackv4v6 stackv4v6) dns in
  let tcp = git_tcp (tcpv4v6_of_stackv4v6 stackv4v6) dns in
  merge_git_clients ssh tcp</code></pre><div class="odoc-spec"><div class="spec type" id="type-git_client" class="anchored"><a href="#type-git_client" class="anchor"></a><code><span><span class="keyword">type</span> git_client</span></code></div><div class="spec-doc"><p>The type for devices that implement the Git protocol.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-git_client" class="anchored"><a href="#val-git_client" class="anchor"></a><code><span><span class="keyword">val</span> git_client : <span><a href="#type-git_client">git_client</a> <a href="#type-typ">typ</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-merge_git_clients" class="anchored"><a href="#val-merge_git_clients" class="anchor"></a><code><span><span class="keyword">val</span> merge_git_clients : <span><span><a href="#type-git_client">git_client</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-git_client">git_client</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-git_client">git_client</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>merge_git_clients a b</code> is a device that can connect to remote Git repositories using either the device <code>a</code> or the device <code>b</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-git_happy_eyeballs" class="anchored"><a href="#val-git_happy_eyeballs" class="anchor"></a><code><span><span class="keyword">val</span> git_happy_eyeballs : 
  <span><span><a href="#type-stackv4v6">stackv4v6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-dns_client">dns_client</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-happy_eyeballs">happy_eyeballs</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-git_client">git_client</a> <a href="#type-impl">impl</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-git_tcp" class="anchored"><a href="#val-git_tcp" class="anchor"></a><code><span><span class="keyword">val</span> git_tcp : <span><span><a href="#type-tcpv4v6">tcpv4v6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-git_client">git_client</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-git_client">git_client</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>git_tcp tcpv4v6 dns</code> is a device able to connect to a remote Git repository using TCP/IP.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-git_ssh" class="anchored"><a href="#val-git_ssh" class="anchor"></a><code><span><span class="keyword">val</span> git_ssh : 
  <span>?authenticator:<span><span>string option</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>key:<span><span>string option</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?mclock:<span><a href="#type-mclock">mclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-tcpv4v6">tcpv4v6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-git_client">git_client</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-git_client">git_client</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>git_ssh ?authenticator ~key tcpv4v6 dns</code> is a device able to connect to a remote Git repository using an SSH connection with the given private <code>key</code>. The identity of the remote Git repository can be verified using <code>authenticator</code>.</p><p>The format of the private key is: <code>&lt;type&gt;:&lt;seed or b64 encoded&gt;</code>. <code>&lt;type&gt;</code> can be <code>rsa</code> or <code>ed25519</code> and, if the type is RSA, we expect the <b>seed</b> of the private key. Otherwise (if the type is Ed25519), we expect the b64-encoded private key.</p><p>The format of the authenticator is <code>SHA256:&lt;b64-encoded-public-key&gt;</code>, the output of:</p><pre><code>$ ssh-keygen -lf &lt;(ssh-keyscan -t rsa|ed25519 remote 2&gt;/dev/null) </code></pre></div></div><div class="odoc-spec"><div class="spec value" id="val-git_http" class="anchored"><a href="#val-git_http" class="anchor"></a><code><span><span class="keyword">val</span> git_http : 
  <span>?authenticator:<span><span>string option</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?headers:<span><span><span>(string * string)</span> list</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?time:<span><a href="#type-time">time</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?pclock:<span><a href="#type-pclock">pclock</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-tcpv4v6">tcpv4v6</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-git_client">git_client</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-git_client">git_client</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>git_http ?authenticator ?headers tcpv4v6 dns</code> is a device able to connect to a remote Git repository via an HTTP(S) connection, using the provided HTTP <code>headers</code>. The identity of the remote Git repository can be verified using <code>authenticator</code>.</p><p>The format of it is:</p><ul><li><code>none</code> no authentication</li><li>key(:&lt;hash&gt;)?:&lt;b64-encoded fingerprint&gt; to authenticate via the key fingerprint</li><li>cert(:&lt;hash&gt;)?:&lt;b64-encoded fingerprint&gt; to authenticate via the cert fingerprint</li><li>trust-anchor(:&lt;der-encoded cert&gt;)+ to authenticate via a list of certificates - By default, we use X.509 trust anchors extracted from Mozilla's NSS</li></ul></div></div><h3 id="other-devices"><a href="#other-devices" class="anchor"></a>Other devices</h3><div class="odoc-spec"><div class="spec value" id="val-job" class="anchored"><a href="#val-job" class="anchor"></a><code><span><span class="keyword">val</span> job : <span><a href="#type-job">job</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p><code>job</code> is the combinator for representing main tasks.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-noop" class="anchored"><a href="#val-noop" class="anchor"></a><code><span><span class="keyword">val</span> noop : <span><a href="#type-job">job</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>noop</code> is a job that does nothing, has no dependency and returns <code>()</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-keys" class="anchored"><a href="#val-keys" class="anchor"></a><code><span><span class="keyword">val</span> keys : <span><span><a href="#type-argv">argv</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-job">job</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>keys argv</code> is a job that loads argv.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-info" class="anchored"><a href="#val-info" class="anchor"></a><code><span><span class="keyword">val</span> info : <span><a href="#type-info">info</a> <a href="#type-typ">typ</a></span></span></code></div><div class="spec-doc"><p><code>info</code> is the combinator to generate <a href="#type-info"><code>info</code></a> values to use at runtime.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-app_info" class="anchored"><a href="#val-app_info" class="anchor"></a><code><span><span class="keyword">val</span> app_info : <span><a href="#type-info">info</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>app_info</code> exports all the information available at configure time into a runtime <a href="../../functoria/Functoria/Info/index.html#type-t"><code>Mirage.Info.t</code></a> value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-app_info_with_opam_deps" class="anchored"><a href="#val-app_info_with_opam_deps" class="anchor"></a><code><span><span class="keyword">val</span> app_info_with_opam_deps : <span><span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-info">info</a> <a href="#type-impl">impl</a></span></span></code></div><div class="spec-doc"><p><code>app_info</code> exports all the information available at configure time into a runtime <a href="../../functoria/Functoria/Info/index.html#type-t"><code>Mirage.Info.t</code></a> value.</p></div></div><h3 id="application-registering"><a href="#application-registering" class="anchor"></a>Application registering</h3><div class="odoc-spec"><div class="spec value" id="val-register" class="anchored"><a href="#val-register" class="anchor"></a><code><span><span class="keyword">val</span> register : 
  <span>?argv:<span><a href="#type-argv">argv</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?tracing:<span><a href="#type-tracing">tracing</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?reporter:<span><a href="#type-reporter">reporter</a> <a href="#type-impl">impl</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?keys:<span><a href="Key/index.html#type-t">Key.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?packages:<span><a href="../../functoria/Functoria/index.html#type-package">Functoria.package</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?src:<span>[ `Auto <span>| `None</span> <span><span>| `Some</span> of string</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="#type-job">job</a> <a href="#type-impl">impl</a></span> list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>register name jobs</code> registers the application named by <code>name</code> which will executes the given <code>jobs</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">packages</span> <p>The opam packages needed by this module.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">keys</span> <p>The keys related to this module.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">tracing</span> <p>Enable tracing.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">reporter</span> <p>Configure logging. The default log reporter is <code>default_reporter</code>. To disable logging, use <code>no_reporter</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">argv</span> <p>Configure command-line argument parsing. The default parser is <code>default_argv</code>. To disable command-line parsing, use <code>no_argv</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec module" id="module-Type" class="anchored"><a href="#module-Type" class="anchor"></a><code><span><span class="keyword">module</span> Type</span><span> = <a href="../../functoria/Functoria/Type/index.html">Functoria.Type</a></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Impl" class="anchored"><a href="#module-Impl" class="anchor"></a><code><span><span class="keyword">module</span> Impl</span><span> = <a href="../../functoria/Functoria/Impl/index.html">Functoria.Impl</a></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Info" class="anchored"><a href="#module-Info" class="anchor"></a><code><span><span class="keyword">module</span> Info</span><span> = <a href="../../functoria/Functoria/Info/index.html">Functoria.Info</a></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Dune" class="anchored"><a href="#module-Dune" class="anchor"></a><code><span><span class="keyword">module</span> Dune</span><span> = <a href="../../functoria/Functoria/Dune/index.html">Functoria.Dune</a></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Action" class="anchored"><a href="#module-Action" class="anchor"></a><code><span><span class="keyword">module</span> Action</span><span> = <a href="../../functoria/Functoria/Action/index.html">Functoria.Action</a></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-FS" class="anchored"><a href="#module-FS" class="anchor"></a><code><span><span class="keyword">module</span> <a href="FS/index.html">FS</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Project" class="anchored"><a href="#module-Project" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Project/index.html">Project</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Tool" class="anchored"><a href="#module-Tool" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Tool/index.html">Tool</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>